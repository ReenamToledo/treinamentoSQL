CREATE DATABASE Universidade;
USE Universidade;

CREATE TABLE Alunos(
    MATRICULA INT PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    endereco VARCHAR(50) NOT NULL,
    cidade VARCHAR(50) NOT NULL 
);

CREATE TABLE Disciplinas(
    COD_DISC VARCHAR(10) PRIMARY KEY,
    nome_disc VARCHAR(50) NOT NULL,
    carga_hor INT NOT NULL
);

CREATE TABLE Professores(
    COD_PROF INT PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    endereco VARCHAR(50) NOT NULL,
    cidade VARCHAR(50) NOT NULL 
);

CREATE TABLE Turma(
    COD_TURMA INT NOT NULL,
    codigo_disciplina VARCHAR(10) NOT NULL,
    codigo_professor INT NOT NULL,
    ano YEAR NOT NULL,
    horario VARCHAR(20),
    PRIMARY KEY (codigo_disciplina, COD_TURMA, codigo_professor, ano),
    FOREIGN KEY (codigo_disciplina) REFERENCES Disciplinas(COD_DISC),
    FOREIGN KEY (codigo_professor) REFERENCES Professores(COD_PROF)
);

CREATE TABLE Historico(
    matricula INT NOT NULL,
    codigo_disciplina VARCHAR(10) NOT NULL,
    codigo_turma INT NOT NULL,
    codigo_professor INT NOT NULL,
    ano YEAR NOT NULL,
    frequencia INT NOT NULL,
    nota INT NOT NULL,
    PRIMARY KEY (matricula, codigo_disciplina, codigo_turma, codigo_professor, ano),
    FOREIGN KEY (matricula) REFERENCES Alunos(MATRICULA),
	FOREIGN KEY (codigo_disciplina, codigo_turma, codigo_professor, ano) REFERENCES Turma(codigo_disciplina, COD_TURMA, codigo_professor, ano)
);

INSERT INTO Alunos(MATRICULA, nome, endereco, cidade)
VALUES (2015010101, "JOSE DE ALENCAR", "RUA DAS ALMAS", "NATAL"),
(2015010102, "JOÃO JOSÉ", "AVENIDA RUY CARNEIRO", "JOÃO PESSOA"),
(2015010103, "MARIA JOAQUINA", "RUA CARROSSEL", "RECIFE"),
(2015010104, " MARIA DAS DORES", "RUA DAS LADEIRAS", "FORTALEZA"),
(2015010105, "JOSUÉ CLAUDINO DOS SANTOS", "CENTRO", "NATAL"),
(2015010106, "JOSUÉLISSON CLAUDINO DOS SANTOS", "CENTRO", "NATAL");

INSERT INTO Disciplinas(COD_DISC, nome_disc, carga_hor)
VALUES ("BD", "BANCO DE DADOS", 100),
("POO", "PROGRAMAÇÃO COM ACESSO A BANCO DE DADOS", 100),
("WEB", "AUTORIA WEB", 50),
("ENG", "ENGENHARIA DE SOFTWARE", 80);

INSERT INTO Professores(COD_PROF, nome, endereco, cidade)
VALUES (212131, "NICKERSON FERREIRA", "RUA MANAÍRA", "JOÃO PESSOA"),
(122135, "ADORILSON BEZERRA", "AVENIDA SALGADO FILHO", "NATAL"),
(192011, "DIEGO OLIVEIRA", "AVENIDA ROBERTO FREIRE", "NATAL");

INSERT INTO Turma(codigo_disciplina, COD_TURMA, codigo_professor, ano, horario)
VALUES ("BD", 1, 212131, 2015, "11H-12H"),
("BD", 2, 212131, 2015, "13H-14H"),
("POO", 1, 192011, 2015, "08H-09H"),
("WEB", 1, 192011, 2015, "07H-08H"),
("ENG", 1, 122135, 2015, "10H-11H");

INSERT INTO Historico(matricula, codigo_disciplina, codigo_turma, codigo_professor, ano, frequencia, nota)
VALUES (2015010101, 'BD', 1, 212131, 2015, 90, 4.5),
(2015010101, 'BD', 2, 212131, 2015, 95, 6.0),
(2015010101, 'POO', 1, 192011, 2015, 80, 7.5),
(2015010101, 'WEB', 1, 192011, 2015, 85, 8.0),
(2015010101, 'ENG', 1, 122135, 2015, 90, 7.0),

(2015010102, 'BD', 1, 212131, 2015, 85, 3.0),
(2015010102, 'BD', 2, 212131, 2015, 90, 6.5),
(2015010102, 'POO', 1, 192011, 2015, 90, 5.0),
(2015010102, 'WEB', 1, 192011, 2015, 75, 6.0),
(2015010102, 'ENG', 1, 122135, 2015, 80, 6.5),

(2015010103, 'BD', 1, 212131, 2015, 75, 2.0),
(2015010103, 'BD', 2, 212131, 2015, 95, 4.0),
(2015010103, 'POO', 1, 192011, 2015, 85, 8.0),
(2015010103, 'WEB', 1, 192011, 2015, 88, 7.5),
(2015010103, 'ENG', 1, 122135, 2015, 92, 8.0),

(2015010104, 'BD', 1, 212131, 2015, 90, 6.0),
(2015010104, 'BD', 2, 212131, 2015, 82, 5.5),
(2015010104, 'POO', 1, 192011, 2015, 92, 4.5),
(2015010104, 'WEB', 1, 192011, 2015, 85, 5.0),
(2015010104, 'ENG', 1, 122135, 2015, 80, 6.0),

(2015010105, 'BD', 1, 212131, 2015, 95, 7.0),
(2015010105, 'BD', 2, 212131, 2015, 90, 8.0),
(2015010105, 'POO', 1, 192011, 2015, 85, 6.5),
(2015010105, 'WEB', 1, 192011, 2015, 80, 7.0),
(2015010105, 'ENG', 1, 122135, 2015, 92, 7.5),

(2015010106, 'BD', 1, 212131, 2015, 93, 4.0),
(2015010106, 'BD', 2, 212131, 2015, 85, 3.5),
(2015010106, 'POO', 1, 192011, 2015, 90, 7.0),
(2015010106, 'WEB', 1, 192011, 2015, 87, 7.5),
(2015010106, 'ENG', 1, 122135, 2015, 90, 7.0);

SELECT DISTINCT matricula FROM Historico WHERE codigo_disciplina = "BD" AND ano = 2015 AND nota < 5;
